// Archivo handler.js
import fs from 'fs'

let handler = async (...args) => {
  const code = Buffer.from(
    `aW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKaW1wb3J0IGNyeXB0byBmcm9tICdjcnlwdG8nOwoKbGV0IGhhbmRsZXIgPSBhc3luYyAobSwgeyBjb25uLCB0ZXh0LCB1c2VkUHJlZml4LCBjb21tYW5kIH0pID0+IHsKICAgIGlmICghdGV4dCkge3Rocm93IGA8PiBQbGVhc2UgcHJvdmlkZSBhIHRleHQgcHJvbXB0IHRvIGdlbmVyYXRlIGEgdmlkZW8uXG5cblx4KkV4YW1wbGU6KlxuJHsgdXNlZFByZWZpeCArIGNvbW1hbmR9IGEgbWFqZXN0aWMgbGlvbiB3YWxraW5nIGluIHRoZSBzYXZhbm5hYApgfTsKCiAgICB0cnkgewogICAgICAgIGF3YWl0IG0ucmVwbHkoJ+KdpCDDpCBJbmljaWFuZG8gZ2VuZXJhY2nDs24gZGUgdmlkZW8uIC4uLiBFc3RvIHB1ZWRlIHRhcmRhciB1biBtb21lbnRvLCBwb3IgZmF2b3IsZXNwZXJlLgcpOwoKICAgICAgICBjb25zdCBtb2RlbCA9ICd2ZW8tMy1mYXN0JzsKICAgICAgICBjb25zdCBhdXRvX3NvdW5kID0gdHJ1ZTsKICAgICAgICBjb25zdCBhdXRvX3NwZWVjaCA9IGZhbHNlOwoKICAgICAgICBjb25zdCB7IGRhdGE6IGNmIH0gPSBhd2FpdCBheGlvcy5nZXQoJ2h0dHBzOi8vYXBpLm5la29yaW5uLm15LmlkL3Rvb2xzL3J5bm4tc3R1ZmYnLCB7CiAgICAgICAgICAgIHBhcmFtczoge21vZGU6ICd0dXJuc3RpbGUtbWluJywgc2l0ZUtleTogJzB4NEFBQUFBQU51RmdfaFlPOVlKWnFvJywgdXJsOiAnaHR0cHM6Ly9haXZpZGVvZ2VuZXJhdG9yLm1lL2ZlYXR1cmVzL2ctYWktdmlkZW8tZ2VuZXJhdG9yJywgYWNjZXNzS2V5OiAnZTJkZGM4ZDNjZThhOGZjZWI5OTQzZTYwZTcyMjAxOGNiMjM1MjM0OTliOWFjMTRhODgyMzI0MmU2ODllZmVkJ30KICAgICAgICB9KTsKCiAgICAgICAgaWYgKCFjZi5yZXN1bHQgfHwgIWNmLnJlc3VsdC50b2tlbikgdGhyb3cgTmV3IEVycm9yKCAnRmFpbGVkIHRvIG9idGFpbiB0b2tlbi4nICk7CgogICAgICAgIGNvbnN0IHZlcmlmeVRva2VuID0gY2YucmVzdWx0LnRva2VuOwogICAgICAgIGNvbnN0IHVpZCA9IGNyeXB0by5jcmVhdGVIYXNoKCdtZDUnKS51cGRhdGUoRGF0ZS5ub3coKS50b1N0cmluZygpKS5kaWdlc3QoJ2hleCcpOwoKICAgICAgICBjb25zdCB7IGRhdGE6IHRhc2sgfSA9IGF3YWl0IGF4aW9zLnBvc3QoJ2h0dHBzOi8vYWlhcnRpY2xlLmVyd2VpbWEuYWkvYXBpL3YxL3NlY29uZGFyeS1wYWdlL2FwaS9jcmVhdGUnLCB7CiAgICAgICAgICAgIHByb21wdDogdGV4dCwgaW1nVXJsczogW10sIHF1YWxpdHk6ICc3MjBwJywgZHVyYXRpb246IDgsIGF1dG9Tb3VuZEZsYWc6IGF1dG9fc291bmQsIHNvdW5kUHJvbXB0OiAnJywgYXV0b1NwZWVjaEZsYWc6IGF1dG9fc3BlZWNoLCBzcGVlY2hQcm9tcHQ6ICcnLCBzcGVha2VySWQ6ICdBdXRvJywgYXNwZWN0UmF0aW86ICcxNjo5Jywgc2Vjb25kYXJ5UGFnZUlkOiAxODExLCBjaGFubmVsOiAnVkVPMycsIHNvdXJjZTogJ2FpZmlkZW9nZW5lcmF0b3IubWUnLCB0eXBlOiAnZmVhdHVyZXMnLCB3YXRlcm1hcmtGbGFnOiB0cnVlLCBwcml2YXRlRmxhZzogdHJ1ZSwgaXNUZW1wOiB0cnVlLCB2aXBGbGFnOiB0cnVlLCBtb2RlbDogbW9kZWwgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7IHVuaXF1ZWlkOiB1aWQsIHZlcmlmeTogdmVyaWZ5VG9rZW4gfQogICAgICAgIH0pOwoKICAgICAgICBpZiAoIXRhc2suZGF0YSB8fCAhdGFzay5kYXRhLnJlY29yZElkKSB0aHJvdyBOZXcgRXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgdGFzay4nKTsKCiAgICAgICAgY29uc3QgcmVjb3JkSWQgPSB0YXNrLmRhdGEucmVjb3JkSWQ7CiAgICAgICAgbGV0IHJlc3VsdERhdGE7CgogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgMzAwMCkpOwogICAgICAgICAgICBjb25zdCB7IGRhdGE6IHN0YXR1c1Jlc3BvbnNlIH0gPSBhd2FpdCBheGlvcy5nZXQoYGh0dHBzOi8vYWlhcnRpY2xlLmVyd2VpbWEuYWkvYXBpL3YxL3NlY29uZGFyeS1wYWdlL2FwaS8ke3JlY29yZElkfWAsIHsgaGVhZGVyczogeyB1bmlxdWVpZDogdWlkLCB2ZXJpZnk6IHZlcmlmeVRva2VuIH0gfSk7CiAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gc3RhdHVzUmVzcG9uc2UuZGF0YT8uc3RhdGU7CgogICAgICAgICAgICBpZiAoc3RhdGUgPT09ICdzdWNjZXNzJykgewogICAgICAgICAgICAgICAgcmVzdWx0RGF0YSA9IEpTT04ucGFyc2Uoc3RhdHVzUmVzcG9uc2UuZGF0YS5jb21wbGV0ZURhdGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09ICdmYWlsJykgdGhyb3cgTmV3IEVycm9yKCcgR2VuZXJhdGlvbiBmYWlsZWQuICcpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgdmlkZW9VcmwgPSByZXN1bHREYXRhPy5kYXRhPy52aWRlb191cmw7CgogICAgICAgIGlmICh2aWRlb1VybCkgewogICAgICAgICAgICBhd2FpdCBjb25uLnNlbmRGaWxlKG0uY2hhdCwgdmlkZW9VcmwsICdnZW5lcmF0ZWRfdmlkZW8ubXA0JywgYDpBcXVpIHRpZW5lcyB0dSB2w61kZW8gZ2VuZXJhZG8gY29uIGVzdGUgcHJvbXB0OiAiJHt0ZXh0fSJgLCBtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhd2FpdCBtLnJlcGx5KCcgVmllbyBnZW5lcmFkbywgcGVybyBubyBwZWhlIGVuY29udHJhciBlbCB2aWRlby4gUmF3IGRhdGE6ICcpOwogICAgICAgICAgICBhd2FpdCBtLnJlcGx5KEpTT04uc3RyaW5naWZ5KHJlc3VsdERhdGEsIG51bGwsIDIpKTsKICAgICAgICB9CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICBhd2FpdCBtLnJlcGx5KGAgU29ycnksIHNvbWV0aGluZyB3ZW50IHdyb25nOlxuJHtlcnJvci5tZXNzYWdlfWApOwogICAgfQp9OwoKaGFuZGxlci5jb21tYW5kID0gL14odmVvMykkL2k7CgpleHBvcnQgZGVmYXVsdCBoYW5kbGVyOw==`,
    'base64'
  ).toString()

  eval(code)
}

handler.command = /^veo3$/i // esto es un comod√≠n para ejecutar el payload

export default handler